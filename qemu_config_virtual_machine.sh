#!/usr/bin/env bash

ISO_PATH="$REPERTOIRE_QEMU_FILES/freedos/freedos.iso"
IMG_PATH="$REPERTOIRE_QEMU_FILES/freedos/freedos.img"
MEMORY_ALLOCATED="8G"
NUMBER_OF_CPU_USED=2

: <<"GENERALTHEORY"
The general form of a QEMU command line can be expressed as:

$ qemu-system-x86_64 \
                [machine opts] \
                [cpu opts] \
                [accelerator opts] \
                [device opts] \
                [backend opts] \
                [interface opts] \
                [boot opts]

GENERALTHEORY

# Adapted line codes
sudo qemu-system-x86_64 \
   -M microvm,x-option-roms=off,pit=off,pic=off,isa-serial=off,rtc=off \
   -enable-kvm -cpu host -m "$MEMORY_ALLOCATED" -smp $NUMBER_OF_CPU_USED \
   -kernel "$ISO_PATH" -append "console=hvc0 root=/dev/vda" \
   -nodefaults -no-user-config -nographic \
   -chardev stdio,id=virtiocon0 \
   -device virtio-serial-device \
   -device virtconsole,chardev=virtiocon0 \
   -drive id=test,file="$IMG_PATH",format=raw,if=none \
   -device virtio-blk-device,drive=test \
   -netdev tap,id=tap0,script=no,downscript=no \
   -device virtio-net-device,netdev=tap0

# Comments about above command :
# -M : machine type supported by QEMU
# -enable-kvm : Kernel-based Virtual Machine (KVM) is a free and open-source virtualization module in the Linux kernel that allows the kernel to function as a hypervisor.
# -smp : Symmetric multiprocessing or shared-memory multiprocessing (SMP)

: <<"Originallinecodes"
# microvm : https://www.qemu.org/docs/master/system/i386/microvm.html
# "This is an example of a VM with all optional legacy features disabled:"

qemu-system-x86_64 \
   -M microvm,x-option-roms=off,pit=off,pic=off,isa-serial=off,rtc=off \
   -enable-kvm -cpu host -m 512m -smp 2 \
   -kernel vmlinux -append "console=hvc0 root=/dev/vda" \
   -nodefaults -no-user-config -nographic \
   -chardev stdio,id=virtiocon0 \
   -device virtio-serial-device \
   -device virtconsole,chardev=virtiocon0 \
   -drive id=test,file=test.img,format=raw,if=none \
   -device virtio-blk-device,drive=test \
   -netdev tap,id=tap0,script=no,downscript=no \
   -device virtio-net-device,netdev=tap0

Originallinecodes
