	# This program aims to be used for tests of overridding the 'fprintf' function.
	# To do so, the 'LD_PRELOAD' environment variable has to be set to a specific shared library built from the file 'fprintf-override.s' that define such function with the command : export LD_PRELOAD=PATH/SHARED-LIB.so
	# Then, when the tests are finished, such environment variable has to be re-set to its initial value OR unset with the command 'unset LD_PRELOAD'.
	.globl main

	.section .data
message_to_print:
	.ascii "\nThis is a simple message printed to test whether the 'fprintf' function from the standard C library was overriden by my own version.\n\0"
	
	.section .text

main:
	# Ensure stack alignment because of external function call.
	enter $0, $0
	
	# Set output to 'stdout'
	movq stdout@GOTPCREL(%rip), %rdi
	movq (%rdi), %rdi
	# Set message to print
	leaq message_to_print(%rip), %rsi
	# No floating-point arguments for variadic function.
	movq $0, %rax
	
	call fprintf

	leave
	ret

#------------------------------------------------------------------------------
	
	# Set non-executable stack ("") that contains program data "@progbits"
	.section .note.GNU-stack, "", @progbits
