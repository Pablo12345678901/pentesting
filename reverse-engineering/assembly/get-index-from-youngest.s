# This file has to be linked with 'person-with-additional-fields-data.s' and will return the maximum value of the specific field choosed below (NEED to be (un)commented)).
	
	.globl _start
	.section .text
_start:
	# Registers used :
	# %rax : current specific field value
	# %rbx : address of the current person struct
	# %rcx : loop counter
	# %rdi : current minimum
	# %rdx : index of current person
	# %rsi : index of current minimum value

	
	# Load address of first record
	leaq people, %rbx

	# Get record count to loop on it.
	movq number_of_people, %rcx

	# Set start index at '0'.
	movq $0, %rdx
	
	# Set default lowest value found to the maximum existing in the range 0-255.
	movq $255, %rdi

	# Exit if there is no record
	cmpq $0, %rcx
	je end_of_program

main_loop:
	# Reminder : %rbx is the pointer to the struct.
	# Depending on the (un)commented line(s), the minimum of the specific field will be returned.
	# The field 'NAME_OFFSET' has no sence to be checked for minimum values on string so it is not proposed here as a field to be returned.
	#movq WEIGTH_OFFSET(%rbx), %rax 
	#movq LAST_TWO_DIGITS_PHONE_NUMBER_OFFSET(%rbx), %rax 
	#movq SHOE_OFFSET(%rbx), %rax 
	#movq HAIR_OFFSET(%rbx), %rax 
	#movq FACEBOOK_FRIENDS_OFFSET(%rbx), %rax 
	#movq HEIGTH_OFFSET(%rbx), %rax 
	movq AGE_OFFSET(%rbx), %rax 

	# If it is bigger (above) or equal than current minimum, get to next value - if any.
	cmpq %rdi, %rax
	jae end_loop
	
	# Else adapt the current minimum.
	movq %rax, %rdi
	# And the corresponding index of such minimum. First person index start at '0'.
	movq %rdx, %rsi

end_loop:
	# Get the address of next person by adding the size of one person to the address of the struct.
	addq $PERSON_RECORD_SIZE, %rbx

	# Increase the current index
	incq %rdx
	
	loopq main_loop
	
end_of_program:
	# Return the index of the minimum value instead of the value itself. First person is at index '0'.
	movq %rsi, %rdi
	
	# Exit syscall
	movq $60, %rax
	syscall
